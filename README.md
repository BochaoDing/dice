# 骰寶
## 概述
骰寶是由各閒家向莊家下註的遊戲。每次下註前，莊家先把三顆骰子放在有蓋的器皿內搖晃，待閒家們下註完畢，莊家便打開器皿並派彩。最常見的玩法是買骰子點數的大小（總點數為3至10稱作小，11至18為大，圍骰莊家通殺）

## 公平
遊戲採用EOS區塊鏈技術，由莊家生成三個隨機數，並採用哈希算法開獎與派彩，所有人都能在每局結束後驗證本局遊戲的公平性。由於區塊鏈技術與哈希算法兩者任何人都不可逆轉，所以能保證遊戲結果不為任何人所控制。

## 算法
### 簡述
莊家開盤前會生成壹串隨機數（32字節）並保密，同時公開展示該數的哈希值作為簽名。簽名本局遊戲中不會變，以保證莊家不會作弊，隨後玩家開始下註。開獎時莊家提供該隨機數給遊戲，遊戲通過簽名驗證該隨機數，並使用隨機數生成三個骰子，然後自動派獎。玩家可以事後驗證該隨機數與簽名公正性。

### 偽代碼

```
if (簽名 == sha256(隨機數[32])) {
    骰子1 = (隨機數[0] + 隨機數[1] + 隨機數[2] + 隨機數[3] + 隨機數[4] + 隨機數[5]) % 6 + 1  
    骰子2 = (隨機數[6] + 隨機數[7] + 隨機數[8] + 隨機數[9] + 隨機數[10]+ 隨機數[11])% 6 + 1  
    骰子3 = (隨機數[12]+ 隨機數[13]+ 隨機數[14]+ 隨機數[15]+ 隨機數[16]+ 隨機數[17])% 6 + 1
} else {
    驗證不過，遊戲出錯
}
```

### 示例

玩家理解算法需要壹些C語言的基礎知識，數值均為十六進制。

在遊戲開獎前，玩家可以獲取莊家事先展示的簽名，本局假設簽名為：
763f42ad937c1a268a17dfbdbb3b8e8bce12bc7cef5ac94f3ab3110ee78f52ca
在遊戲結束後，莊家會展示該簽名所對應的哈希原值（隨機數），原值如下：
c6793186e4a0c748118a5070faf7a4ffdd07ea9d07d9f6ca25c4d59b88c6e58a
套用上方公式可以計算得出

```
commitment = 763f42ad937c1a268a17dfbdbb3b8e8bce12bc7cef5ac94f3ab3110ee78f52ca
source = c6793186e4a0c748118a5070faf7a4ffdd07ea9d07d9f6ca25c4d59b88c6e58a
if (commitment == sha256(source)) {
    3 = (c6 + 79 + 31 + 86 + e4 + a0) % 6 + 1
    1 = (c7 + 48 + 11 + 8a + 50 + 70) % 6 + 1
    5 = (fa + f7 + a4 + ff + dd + 07) % 6 + 1
}
```
3, 1, 5便是本次開獎結果

### 第三方驗證
查詢壹些公示信息可以通過任何第三方網站，比如：[https://bloks.io/](https://bloks.io/)

簽名，開獎前就能查詢：  
search - > 莊家名 -> Account Transactions -> Contract -> Tables -> Step 2 - Select Table -> game -> Load Table -> 當前遊戲編號 -> commitment  
原值，開獎後莊家公開：  
search - > 莊家名 -> Account Transactions -> Contract -> Tables -> Step 2 - Select Table -> game -> Load Table -> 當前遊戲編號 -> source

計算sha256，這裡以linux操作系統為例。註意，sha256的計算這裡是整形數值，而不是字符串：  

```bash
>> echo -n 'c6793186e4a0c748118a5070faf7a4ffdd07ea9d07d9f6ca25c4d59b88c6e58a' | xxd -r -p | sha256sum -b | awk '{print $1}'

>> 763f42ad937c1a268a17dfbdbb3b8e8bce12bc7cef5ac94f3ab3110ee78f52ca
```


